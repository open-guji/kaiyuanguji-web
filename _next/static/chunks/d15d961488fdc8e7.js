(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33525,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"warnOnce",{enumerable:!0,get:function(){return a}});let a=e=>{}},85130,89271,e=>{"use strict";var t,r=((t={}).WORK="work",t.COLLECTION="collection",t.BOOK="book",t);e.s(["BookResourceType",()=>r],89271);var a=e.i(85149);let o={};async function n(e,t){try{let a=await fetch(e,{cache:"no-store",signal:AbortSignal.timeout(5e3)});if(!a.ok)throw Error(`Failed to fetch from ${e}: ${a.statusText}`);let o=await a.json(),n=[],s=(e,r)=>{e&&Object.values(e).forEach(e=>{n.push({id:e.id,name:e.title||e.name,type:r,isDraft:t,rawPath:e.path,author:e.author,collection:e.collection,year:e.year,holder:e.holder})})};return s(o.books,r.BOOK),s(o.collections,r.COLLECTION),s(o.works,r.WORK),n}catch(e){throw e}}async function s(e="github"){if(o[e])return o[e];let t=[],r=async t=>{if("github"===e)return n(t?a.GITHUB_BOOK_INDEX_DRAFT:a.GITHUB_BOOK_INDEX,t);let r=t?"book-index-draft":"book-index",o="main",s=`${a.JSDELIVR_FASTLY}/${a.GITHUB_ORG}/${r}@${o}/index.json`,i=`${a.JSDELIVR_CDN}/${a.GITHUB_ORG}/${r}@${o}/index.json`;try{return await n(s,t)}catch(e){return console.warn("Fastly index fetch failed, trying fallback:",e),await n(i,t)}};try{let e=await r(!0);t.push(...e)}catch(t){console.warn(`Failed to fetch draft index from ${e}:`,t)}try{let e=await r(!1);t.push(...e)}catch(t){console.warn(`Failed to fetch official index from ${e}:`,t)}let i=new Map;t.forEach(e=>{i.set(e.id,e)});let l=Array.from(i.values());return o[e]=l,l}async function i(e,t="github"){return(await s(t)).find(t=>t.id===e)||null}async function l(e,t="github"){if("github"===t){let r=e.isDraft?`${a.GITHUB_BASE}/${a.GITHUB_ORG}/book-index-draft/main`:`${a.GITHUB_BASE}/${a.GITHUB_ORG}/book-index/main`,o=`${r}/${e.rawPath}`,n=await fetch(o,{cache:"no-store",signal:AbortSignal.timeout(1e4)});if(!n.ok)throw Error(`Failed to fetch book content from ${t}: ${n.statusText}`);return n.text()}let r=e.isDraft?"book-index-draft":"book-index",o="main",n=`${a.JSDELIVR_FASTLY}/${a.GITHUB_ORG}/${r}@${o}/${e.rawPath}`,s=`${a.JSDELIVR_CDN}/${a.GITHUB_ORG}/${r}@${o}/${e.rawPath}`;try{let e=await fetch(n,{cache:"no-store",signal:AbortSignal.timeout(8e3)});if(!e.ok)throw Error(`Fastly status: ${e.status}`);return await e.text()}catch(t){console.warn("Fastly fetch failed, trying fallback CDN:",t);let e=await fetch(s,{cache:"no-store",signal:AbortSignal.timeout(1e4)});if(!e.ok)throw Error(`Failed to fetch book content from CDN: ${e.statusText}`);return await e.text()}}function c(e){switch(e){case r.WORK:return"作品";case r.COLLECTION:return"丛编";case r.BOOK:return"书";default:return""}}function d(e){return e?"草稿":"正式"}e.s(["fetchAllBooks",()=>s,"fetchBookContent",()=>l,"findBookById",()=>i,"getStatusLabel",()=>d,"getTypeLabel",()=>c],85130)},45013,e=>{"use strict";var t=e.i(18050),r=e.i(71645),a=e.i(22016),o=e.i(42303),n=e.i(66073),s=e.i(85130);function i({text:e,label:a}){let[o,n]=(0,r.useState)(!1),s=async()=>{try{await navigator.clipboard.writeText(e),n(!0),setTimeout(()=>n(!1),2e3)}catch(e){console.error("Failed to copy:",e)}};return(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[a&&(0,t.jsxs)("span",{className:"text-secondary/60",children:[a,":"]}),(0,t.jsxs)("button",{onClick:s,className:"flex items-center gap-1.5 px-2 py-1 rounded bg-paper/50 hover:bg-border/30  text-secondary hover:text-vermilion transition-all duration-200  border border-border/40 group focus:ring-2 focus:ring-vermilion/20 focus:outline-none",title:`复制 ${a||"内容"}`,"aria-label":o?"已复制":`复制 ${a?`${a}: `:""}${e}`,children:[(0,t.jsx)("span",{className:"font-mono text-secondary/80 group-hover:text-vermilion transition-colors",children:e}),(0,t.jsx)("svg",{className:`w-3.5 h-3.5 transition-colors ${o?"text-green-600":"text-secondary/50 group-hover:text-vermilion"}`,fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",viewBox:"0 0 24 24",stroke:"currentColor",children:o?(0,t.jsx)("path",{d:"M5 13l4 4L19 7"}):(0,t.jsx)("path",{d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})]})]})}var l=e.i(76289),c=e.i(67920),d=e.i(18566);function u({id:e}){let{source:u}=(0,c.useSource)(),[x,f]=(0,r.useState)(null),[h,m]=(0,r.useState)(""),[p,b]=(0,r.useState)(!0),[g,w]=(0,r.useState)(null);if((0,r.useEffect)(()=>{(async()=>{try{b(!0),w(null);let t=await (0,s.findBookById)(e,u);if(!t)return void w("not-found");f(t);let r=await (0,s.fetchBookContent)(t,u);m(r)}catch(e){w(e instanceof Error?e.message:"加载失败")}finally{b(!1)}})()},[e,u]),"not-found"===g&&(0,d.notFound)(),p)return(0,t.jsx)(o.default,{children:(0,t.jsxs)("div",{className:"max-w-4xl mx-auto px-6 py-8 animate-pulse",children:[(0,t.jsx)("div",{className:"h-8 w-48 bg-paper/50 rounded mb-8"}),(0,t.jsx)("div",{className:"h-12 w-3/4 bg-paper/50 rounded mb-8"}),(0,t.jsx)("div",{className:"h-64 w-full bg-paper/50 rounded"})]})});if(!x)return null;let y=h.replace(/^#\s+.+\r?\n*/m,"").replace(/^(ID|id)[:：].*\r?\n*/mi,"").trim();return(0,t.jsx)(o.default,{children:(0,t.jsxs)("div",{className:"max-w-4xl mx-auto px-6 py-8",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-8 flex-wrap gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 flex-wrap",children:[(0,t.jsxs)(a.default,{href:"/book-index",className:"flex items-center gap-1 text-sm text-secondary hover:text-vermilion transition-colors",children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{d:"M15 19l-7-7 7-7"})}),(0,t.jsx)("span",{children:"返回索引"})]}),(0,t.jsx)("span",{className:"text-secondary/30",children:"|"}),(0,t.jsx)("span",{className:"px-2 py-0.5 text-xs font-medium rounded bg-paper text-secondary border border-border/60",children:(0,s.getTypeLabel)(x.type)}),(0,t.jsx)("span",{className:`px-2 py-0.5 text-xs font-medium rounded ${x.isDraft?"text-orange-600 bg-orange-50":"text-green-600 bg-green-50"}`,children:(0,s.getStatusLabel)(x.isDraft)})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(l.default,{}),(0,t.jsx)(i,{text:x.id,label:"ID"})]})]}),(0,t.jsx)("h1",{className:"text-4xl font-bold text-ink mb-8 tracking-wide",children:x.name}),(0,t.jsx)("div",{className:"prose max-w-none",children:(0,t.jsx)(n.default,{content:y})})]})})}e.s(["default",()=>u],45013)}]);